# Teleprompter Design Document

## 1. 目标

本项目目标是提供一个轻量、可离线运行的单页提词器，满足以下核心需求：
- 用户输入提词文本
- 文本在独立展示区自动向上滚动
- 展示区具备透明感和上下渐隐视觉效果
- 用户可实时调整滚动速度
- 用户可切换背景配色、字体配色与字体大小

## 2. 范围与边界

当前版本范围：
- 单文件实现（HTML + CSS + JavaScript）
- 本地浏览器直接打开即可运行
- 基础播放控制（开始、暂停、重置）
- 视觉可配置（背景主题、字体主题、字号）

暂不包含：
- 文本文件导入/导出
- 远程同步
- 分段跳转与标记点

## 3. 页面结构

文件：`teleprompter.html`

主要区域：
- 控制区（`.controls`）
- 提词展示区（`.teleprompter`）

关键元素：
- `#sourceText`：输入提词内容
- `#startBtn` / `#pauseBtn` / `#resetBtn`：播放控制
- `#speedRange` + `#speedValue`：速度调节与显示
- `#bgThemeSelect`：背景配色方案选择
- `#textThemeSelect`：字体配色方案选择
- `#fontSizeRange` + `#fontSizeValue`：字号调节与显示
- `#content`：可滚动容器
- `#displayText`：实际展示文本

## 4. 视觉设计

设计原则：
- 高可读性：大字号、宽行距、可配置字体颜色
- 低干扰：隐藏滚动条，保留简洁控件
- 透明感：展示区半透明背景 + 渐隐蒙层
- 可定制：提供常用高对比背景与文字主题

关键实现：
- 通过 CSS 变量管理视觉参数，保证主题切换开销低
- 背景使用渐变主题（深海蓝、日出橙、演播灰、森林绿）
- 字体提供 4 套配色（经典白、暖黄、薄荷绿、高对比）
- 字号通过滑块实时修改 `--prompt-size`

## 5. 滚动机制

滚动采用 `requestAnimationFrame`（RAF）驱动，而非 `setInterval`：
- 刷新节奏由浏览器调度，动画更平滑
- 通过时间差 `deltaSec` 进行速度积分，保证“像素/秒”语义稳定

公式：
- 每帧位移 = `speed * deltaSec`
- `speed` 来源于滑块数值（单位：px/s）

停止条件：
- 当 `scrollTop >= scrollHeight - clientHeight` 时自动停止

## 6. 状态管理

核心状态变量：
- `isRunning`：是否正在滚动
- `speed`：当前滚动速度
- `lastTime`：上一帧时间戳
- `rafId`：当前动画帧 ID，用于取消动画

视觉配置对象：
- `backgroundThemes`：背景主题集合
- `textThemes`：文字主题集合

行为说明：
- `start()`：若未运行，则启动 RAF
- `pause()`：停止滚动并取消当前 RAF
- `reset()`：暂停后回到顶部
- `applyBackgroundTheme()`：应用背景主题到 CSS 变量
- `applyTextTheme()`：应用文字主题到 CSS 变量
- `applyFontSize()`：更新字号变量与显示标签

## 7. 文本同步策略

输入框变化时：
1. 先计算当前阅读进度比例
2. 同步新文本到展示区
3. 按新内容高度恢复接近原进度位置

意义：
- 避免编辑文本后滚动位置突变
- 提升演讲排练场景下的连续性

## 8. 响应式与兼容性

已考虑：
- 控件区域支持换行，适配窄屏
- 字号支持 24px-72px 动态调整
- 隐藏滚动条时覆盖主流浏览器写法

建议运行环境：
- Chrome / Edge / Firefox 新版本

## 9. 可扩展路线

建议优先级：
1. 快捷键支持（空格开始/暂停、上下键调速）
2. 镜像模式（演播提词器常用）
3. 主题持久化（LocalStorage）
4. 本地稿件管理
5. 多稿件切换

## 10. 测试清单（手工）

建议每次改动后最少验证：
- 输入较长文本后可连续滚动到底
- 速度滑块变化后，滚动速度即时变化
- 暂停后继续播放位置正确
- 重置后回到顶部
- 切换不同背景与字体配色后可读性正常
- 字号在最小和最大值下布局不破坏
- 移动端与桌面端显示正常
